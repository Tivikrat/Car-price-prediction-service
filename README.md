# Car-price-prediction-service
##Скрипти
###Попередня обробка даних
Попередня обробка даних виконується скриптом prepare.py.

Приклад використання:

`py prepare.py -i train.csv -o prepared_train.csv`

Якщо потрібно розробляти модель, підбирати її параметри, то можна розділити тренувальний датасет на власне тренувальний (80% записів) і валідаційний (20% записів) за допомогою скрипта split.py. При цьому варто вказати назву цільового (target) стовпця через атрибут -g.

Приклад використання:

`py split.py -i prepared_train.csv -t training.csv -v validating.csv -g price`
###Підготовка моделі
Тренування виконується скриптом train.py.

Тренування на датасеті training.csv із цільовою колонкою price, 10 ітерацій, кожні 2 ітерації збереження:

```
py train.py -i training.csv -g price -t 10 -s 2
-i тренувальний датасет
-g цільова колонка (target)
-t кількість ітерацій тренування (default=1)
-s кількість ітерацій тренування, при кожному виконанні яких модель зберігається
    (default=1, зберігання на кожній ітерації)
    Якщо встановлено 0 — єдине збереження по завершенню всіх ітерацій
``` 
Для формування моделі для випуску варто скористатися всіма 100% рядків, тому тренувальним датасетом тут буде prepared_train.csv.
###Прогнозування
Втілено в app.py при зверненні за напрямком /predict/.
##Flask пакет
Наявний Flask пакет має app.py (root) і шаблони, розміщені в папці templates із розширенням .html.
##Розгортання сервісу локально
Для запуску контейнера docker на Linux платформі достатньо запустити
```
bash run.sh
```
По-ідеї після завершення виконання відкриється браузер із відображенням форми. Про всяк випадок Створюється файл docker.url, в якому міститься посилання на запущений контейнер. Посилання можна скопіювати, вставити в браузер. Якщо домен представлений як "0.0.0.0", то його варто замінити на "127.0.0.1" або "localhost".

Після завершення роботи з контейнером його можна зупинити й видалити, виконавши:
```
bash close.sh
```
##Розгортання в хмарному сервісі
http://auction-car-price-predictor.herokuapp.com/
##Повнота Dockerfile
Dockerfile наведено в Dockerfile
##Оформлення сервісу - frontend
```
/           використовує шаблон index.html без заповнення полів і ціни
/predict    використовує шаблон index.html заповнюючи раніше заповнені поля і наводячи ціну
/version    використовує шаблон version.html
```
##Повнота REST API
Наведені вище шляхи мають місце й у REST API
##Оновлення моделі сервісу та методу навчання
Моделі сервісу створюються при тренуванні і мають назву `<час від початку UNIX>_<помилковість моделі на тренувальних даних>.npy`.
Як правило, чим менша помилковість на тренувальних даних, тим менша й на валідаційних, тож варто обирати модель із найменшим таким показником.

Далі варто **скопіювати** вибрану модель до `model.npy` (замінити, якщо такий файл вже є). Запущена система відразу почне використовувати нову версію.

Зміна методу навчання можлива шляхом зміни `train.py` (змінювати обережно, краще робити резервні копії)

##Репозиторій проекту GitHub
https://github.com/Tivikrat/Car-price-prediction-service

##Інструкція та готовність до розгортання третіми особами
Підозрюю, що Ви вже прочитали цю інструкцію. Надіюсь, розгортання теж вдасться.